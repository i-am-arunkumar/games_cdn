!function(){"use strict";for(var t=0,e=["webkit","moz"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var s=new Date().getTime(),a=Math.max(0,16-(s-t)),h=window.setTimeout(function(){e(s+a)},a);return t=s+a,h}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(){"use strict";function t(t,e){return RegExp(" "+e+" ").test(" "+t.className+" ")}function e(e,i){t(e,i)||(e.className+=" "+i)}function i(e,i){var s=" "+e.className.replace(/[\t\r\n]/g," ")+" ";if(t(e,i)){for(;s.indexOf(" "+i+" ")>=0;)s=s.replace(" "+i+" "," ");e.className=s.replace(/^\s+|\s+$/g,"")}}function s(e,i){var s=" "+e.className.replace(/[\t\r\n]/g," ")+" ";if(t(e,i)){for(;s.indexOf(" "+i+" ")>=0;)s=s.replace(" "+i+" "," ");e.className=s.replace(/^\s+|\s+$/g,"")}else e.className+=" "+i}}(),g={},function(){"use strict";g.m=Math,g.mathProps="E LN10 LN2 LOG2E LOG10E PI SQRT1_2 SQRT2 abs acos asin atan ceil cos exp floor log round sin sqrt tan atan2 pow max min".split(" ");for(var t=0;t<g.mathProps.length;t++)g[g.mathProps[t]]=g.m[g.mathProps[t]];g.m.TWO_PI=2*g.m.PI,g.isset=function(t){return void 0!==t},g.log=function(){g.isset(g.config)&&g.config.debug&&window.console&&console.log(Array.prototype.slice.call(arguments))}}(),g.Group=function(){this.collection=[],this.length=0},g.Group.prototype.add=function(t){this.collection.push(t),this.length++},g.Group.prototype.remove=function(t){t<this.length&&(this.collection.splice(t,1),this.length--)},g.Group.prototype.empty=function(){this.collection.length=0,this.length=0},g.Group.prototype.each=function(t,e){var i,e=e||0;if(e)for(i=0;i<this.length;i++)this.collection[i][t](i);else for(i=this.length;i--;)this.collection[i][t](i)},g.util={},g.util.rand=function(t,e){return g.m.random()*(e-t)+t},g.util.randInt=function(t,e){return g.m.floor(g.m.random()*(e-t+1))+t},g.states={},g.addState=function(t){g.states[t.name]=t},g.setState=function(t){g.state&&g.states[g.state].exit(),g.state=t,g.states[g.state].init()},g.currentState=function(){return g.states[g.state]},g.Time=function(){this.reset()},g.Time.prototype.reset=function(){this.now=Date.now(),this.last=Date.now(),this.delta=60,this.ndelta=1,this.elapsed=0,this.nelapsed=0,this.tick=0},g.Time.prototype.update=function(){this.now=Date.now(),this.delta=this.now-this.last,this.ndelta=Math.min(Math.max(this.delta/(1e3/60),1e-4),10),this.elapsed+=this.delta,this.nelapsed+=this.ndelta,this.last=this.now,this.tick++},g.Grid=function(t,e){this.cols=t,this.rows=e,this.tiles=[];for(var i=0;i<t;i++){this.tiles[i]=[];for(var s=0;s<e;s++)this.tiles[i].push("empty")}},g.Grid.prototype.get=function(t,e){return this.tiles[t][e]},g.Grid.prototype.set=function(t,e,i){this.tiles[t][e]=i},g.BoardTile=function(t){this.parentState=t.parentState,this.parentGroup=t.parentGroup,this.col=t.col,this.row=t.row,this.x=t.x,this.y=t.y,this.z=0,this.w=t.w,this.h=t.h,this.elem=document.createElement("div"),this.elem.style.position="absolute",this.elem.className="tile",this.parentState.stageElem.appendChild(this.elem),this.classes={pressed:0,path:0,up:0,down:0,left:0,right:0},this.updateDimensions()},g.BoardTile.prototype.update=function(){for(var t in this.classes)this.classes[t]&&this.classes[t]--;this.parentState.food.tile.col==this.col||this.parentState.food.tile.row==this.row?(this.classes.path=1,this.col<this.parentState.food.tile.col?this.classes.right=1:this.classes.right=0,this.col>this.parentState.food.tile.col?this.classes.left=1:this.classes.left=0,this.row>this.parentState.food.tile.row?this.classes.up=1:this.classes.up=0,this.row<this.parentState.food.tile.row?this.classes.down=1:this.classes.down=0):this.classes.path=0,this.parentState.food.eaten&&(this.classes.path=0)},g.BoardTile.prototype.updateDimensions=function(){this.x=this.col*this.parentState.tileWidth,this.y=this.row*this.parentState.tileHeight,this.w=this.parentState.tileWidth-this.parentState.spacing,this.h=this.parentState.tileHeight-this.parentState.spacing,this.elem.style.left=this.x+"px",this.elem.style.top=this.y+"px",this.elem.style.width=this.w+"px",this.elem.style.height=this.h+"px"},g.BoardTile.prototype.render=function(){var t="";for(var e in this.classes)this.classes[e]&&(t+=e+" ");this.elem.className="tile "+t},g.SnakeTile=function(t){this.parentState=t.parentState,this.parentGroup=t.parentGroup,this.col=t.col,this.row=t.row,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this.color=null,this.scale=1,this.rotation=0,this.blur=0,this.alpha=1,this.borderRadius=0,this.borderRadiusAmount=0,this.elem=document.createElement("div"),this.elem.style.position="absolute",this.parentState.stageElem.appendChild(this.elem)},g.SnakeTile.prototype.update=function(t){this.x=this.col*this.parentState.tileWidth,this.y=this.row*this.parentState.tileHeight,0==t?(this.color="#fff",this.blur=.03*this.parentState.dimAvg+Math.sin(this.parentState.time.elapsed/200)*this.parentState.dimAvg*.015,"n"==this.parentState.snake.dir?this.borderRadius=this.borderRadiusAmount+"% "+this.borderRadiusAmount+"% 0 0":"s"==this.parentState.snake.dir?this.borderRadius="0 0 "+this.borderRadiusAmount+"% "+this.borderRadiusAmount+"%":"e"==this.parentState.snake.dir?this.borderRadius="0 "+this.borderRadiusAmount+"% "+this.borderRadiusAmount+"% 0":"w"==this.parentState.snake.dir&&(this.borderRadius=this.borderRadiusAmount+"% 0 0 "+this.borderRadiusAmount+"%")):(this.color="#fff",this.blur=0,this.borderRadius="0"),this.alpha=1-t/this.parentState.snake.tiles.length*.6,this.rotation=this.parentState.snake.justAteTick/this.parentState.snake.justAteTickMax*90,this.scale=1+this.parentState.snake.justAteTick/this.parentState.snake.justAteTickMax*1},g.SnakeTile.prototype.updateDimensions=function(){this.w=this.parentState.tileWidth-this.parentState.spacing,this.h=this.parentState.tileHeight-this.parentState.spacing},g.SnakeTile.prototype.render=function(t){this.elem.style.left=this.x+"px",this.elem.style.top=this.y+"px",this.elem.style.width=this.w+"px",this.elem.style.height=this.h+"px",this.elem.style.backgroundColor="rgba(56, 1, 100, "+this.alpha+")",this.elem.style.borderRadius=this.borderRadius,this.elem.classList.add("snake-head")},g.FoodTile=function(t){this.parentState=t.parentState,this.parentGroup=t.parentGroup,this.col=t.col,this.row=t.row,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this.blur=0,this.scale=1,this.hue=100,this.opacity=0,this.elem=document.createElement("div"),this.elem.style.position="absolute",this.parentState.stageElem.appendChild(this.elem)},g.FoodTile.prototype.update=function(){this.x=this.col*this.parentState.tileWidth,this.y=this.row*this.parentState.tileHeight,this.blur=.03*this.parentState.dimAvg+Math.sin(this.parentState.time.elapsed/200)*this.parentState.dimAvg*.015,this.scale=.8+.2*Math.sin(this.parentState.time.elapsed/200),this.parentState.food.birthTick||this.parentState.food.deathTick?this.parentState.food.birthTick?this.opacity=1-this.parentState.food.birthTick/1*1:this.opacity=this.parentState.food.deathTick/1*1:this.opacity=1},g.FoodTile.prototype.updateDimensions=function(){this.w=this.parentState.tileWidth-this.parentState.spacing,this.h=this.parentState.tileHeight-this.parentState.spacing},g.FoodTile.prototype.render=function(){this.elem.style.left=this.x+"px",this.elem.style.top=this.y+"px",this.elem.style.width=this.w+"px",this.elem.style.height=this.h+"px",this.elem.style.transform="translateZ(0) scale("+this.scale+")",this.elem.style.backgroundColor="hsla(259, 100%, 73%, 1)",this.elem.style.opacity=this.opacity},g.Snake=function(t){this.parentState=t.parentState,this.dir="e",this.currDir=this.dir,this.tiles=[];for(var e=0;e<5;e++)this.tiles.push(new g.SnakeTile({parentState:this.parentState,parentGroup:this.tiles,col:8-e,row:3,x:(8-e)*t.parentState.tileWidth,y:3*t.parentState.tileHeight,w:t.parentState.tileWidth-t.parentState.spacing,h:t.parentState.tileHeight-t.parentState.spacing}));this.last=0,this.updateTick=10,this.updateTickMax=this.updateTick,this.updateTickLimit=3,this.updateTickChange=.2,this.deathFlag=0,this.justAteTick=0,this.justAteTickMax=1,this.justAteTickChange=.05;for(var e=this.tiles.length;e--;)this.parentState.grid.set(this.tiles[e].col,this.tiles[e].row,"snake")},g.Snake.prototype.updateDimensions=function(){for(var t=this.tiles.length;t--;)this.tiles[t].updateDimensions()},g.Snake.prototype.update=function(){if(this.parentState.keys.up?"s"!=this.dir&&"n"!=this.dir&&"s"!=this.currDir&&"n"!=this.currDir&&(this.dir="n"):this.parentState.keys.down?"n"!=this.dir&&"s"!=this.dir&&"n"!=this.currDir&&"s"!=this.currDir&&(this.dir="s"):this.parentState.keys.right?"w"!=this.dir&&"e"!=this.dir&&"w"!=this.currDir&&"e"!=this.currDir&&(this.dir="e"):this.parentState.keys.left&&"e"!=this.dir&&"w"!=this.dir&&"e"!=this.currDir&&"w"!=this.currDir&&(this.dir="w"),this.parentState.keys.up=0,this.parentState.keys.down=0,this.parentState.keys.right=0,this.parentState.keys.left=0,this.updateTick+=this.parentState.time.ndelta,this.updateTick>=this.updateTickMax){this.updateTick=this.updateTick-this.updateTickMax,this.tiles.unshift(new g.SnakeTile({parentState:this.parentState,parentGroup:this.tiles,col:this.tiles[0].col,row:this.tiles[0].row,x:this.tiles[0].col*this.parentState.tileWidth,y:this.tiles[0].row*this.parentState.tileHeight,w:this.parentState.tileWidth-this.parentState.spacing,h:this.parentState.tileHeight-this.parentState.spacing})),this.last=this.tiles.pop(),this.parentState.stageElem.removeChild(this.last.elem),this.parentState.boardTiles.collection[this.last.col+this.last.row*this.parentState.cols].classes.pressed=2;for(var t=this.tiles.length;t--;)this.parentState.grid.set(this.tiles[t].col,this.tiles[t].row,"snake");if(this.parentState.grid.set(this.last.col,this.last.row,"empty"),"n"==this.dir?(this.currDir="n",this.tiles[0].row-=1):"s"==this.dir?(this.currDir="s",this.tiles[0].row+=1):"w"==this.dir?(this.currDir="w",this.tiles[0].col-=1):"e"==this.dir&&(this.currDir="e",this.tiles[0].col+=1),this.wallFlag=!1,this.tiles[0].col>=this.parentState.cols&&(this.tiles[0].col=0,this.wallFlag=!0),this.tiles[0].col<0&&(this.tiles[0].col=this.parentState.cols-1,this.wallFlag=!0),this.tiles[0].row>=this.parentState.rows&&(this.tiles[0].row=0,this.wallFlag=!0),this.tiles[0].row<0&&(this.tiles[0].row=this.parentState.rows-1,this.wallFlag=!0),"snake"==this.parentState.grid.get(this.tiles[0].col,this.tiles[0].row)&&(this.deathFlag=1,clearTimeout(this.foodCreateTimeout)),"food"==this.parentState.grid.get(this.tiles[0].col,this.tiles[0].row)){this.tiles.push(new g.SnakeTile({parentState:this.parentState,parentGroup:this.tiles,col:this.last.col,row:this.last.row,x:this.last.col*this.parentState.tileWidth,y:this.last.row*this.parentState.tileHeight,w:this.parentState.tileWidth-this.parentState.spacing,h:this.parentState.tileHeight-this.parentState.spacing})),this.updateTickMax-this.updateTickChange>this.updateTickLimit&&(this.updateTickMax-=this.updateTickChange),this.parentState.score++,this.parentState.scoreElem.innerHTML=this.parentState.score,this.justAteTick=this.justAteTickMax,this.parentState.food.eaten=1,this.parentState.stageElem.removeChild(this.parentState.food.tile.elem);var e=this;this.foodCreateTimeout=setTimeout(function(){e.parentState.food=new g.Food({parentState:e.parentState})},300)}this.deathFlag&&g.setState("play")}for(var t=this.tiles.length;t--;)this.tiles[t].update(t);this.justAteTick>0?this.justAteTick-=this.justAteTickChange:this.justAteTick<0&&(this.justAteTick=0)},g.Snake.prototype.render=function(){for(var t=this.tiles.length;t--;)this.tiles[t].render(t)},g.Food=function(t){this.parentState=t.parentState,this.tile=new g.FoodTile({parentState:this.parentState,col:0,row:0,x:0,y:0,w:t.parentState.tileWidth-t.parentState.spacing,h:t.parentState.tileHeight-t.parentState.spacing}),this.reset(),this.eaten=0,this.birthTick=1,this.deathTick=0,this.birthTickChange=.025,this.deathTickChange=.05},g.Food.prototype.reset=function(){for(var t=[],e=0;e<this.parentState.cols;e++)for(var i=0;i<this.parentState.rows;i++)"empty"==this.parentState.grid.get(e,i)&&t.push({x:e,y:i});var s=t[g.util.randInt(0,t.length-1)];this.tile.col=s.x,this.tile.row=s.y},g.Food.prototype.updateDimensions=function(){this.tile.updateDimensions()},g.Food.prototype.update=function(){this.tile.update(),this.birthTick>0?this.birthTick-=this.birthTickChange:this.birthTick<0&&(this.birthTick=0),this.parentState.grid.set(this.tile.col,this.tile.row,"food")},g.Food.prototype.render=function(){this.tile.render()},function(){"use strict";function t(){this.name="play"}t.prototype.init=function(){this.scoreElem=document.querySelector(".score"),this.stageElem=document.querySelector(".stage"),this.dimLong=28,this.dimShort=16,this.padding=.25,this.boardTiles=new g.Group,this.keys={},this.foodCreateTimeout=null,this.score=0,this.scoreElem.innerHTML=this.score,this.time=new g.Time,this.getDimensions(),this.winWidth<this.winHeight?(this.rows=this.dimLong,this.cols=this.dimShort):(this.rows=this.dimShort,this.cols=this.dimLong),this.spacing=1,this.grid=new g.Grid(this.cols,this.rows),this.resize(),this.createBoardTiles(),this.bindEvents(),this.snake=new g.Snake({parentState:this}),this.food=new g.Food({parentState:this})},t.prototype.getDimensions=function(){this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.activeWidth=this.winWidth-this.winWidth*this.padding,this.activeHeight=this.winHeight-this.winHeight*this.padding},t.prototype.resize=function(){var t=g.currentState();t.getDimensions(),t.stageRatio=t.rows/t.cols,t.activeWidth>t.activeHeight/t.stageRatio?(t.stageHeight=t.activeHeight,t.stageElem.style.height=t.stageHeight+"px",t.stageWidth=Math.floor(t.stageHeight/t.stageRatio),t.stageElem.style.width=t.stageWidth+"px"):(t.stageWidth=t.activeWidth,t.stageElem.style.width=t.stageWidth+"px",t.stageHeight=Math.floor(t.stageWidth*t.stageRatio),t.stageElem.style.height=t.stageHeight+"px"),t.tileWidth=~~(t.stageWidth/t.cols),t.tileHeight=~~(t.stageHeight/t.rows),t.dimAvg=(t.activeWidth+t.activeHeight)/2,t.spacing=Math.max(1,~~(.0025*t.dimAvg)),t.stageElem.style.marginTop=-t.stageElem.offsetHeight/2+t.headerHeight/2+"px",t.boardTiles.each("updateDimensions"),void 0!==t.snake&&t.snake.updateDimensions(),void 0!==t.food&&t.food.updateDimensions()},t.prototype.createBoardTiles=function(){for(var t=0;t<this.rows;t++)for(var e=0;e<this.cols;e++)this.boardTiles.add(new g.BoardTile({parentState:this,parentGroup:this.boardTiles,col:e,row:t,x:e*this.tileWidth,y:t*this.tileHeight,w:this.tileWidth-this.spacing,h:this.tileHeight-this.spacing}))},t.prototype.upOn=function(){g.currentState().keys.up=1},t.prototype.downOn=function(){g.currentState().keys.down=1},t.prototype.rightOn=function(){g.currentState().keys.right=1},t.prototype.leftOn=function(){g.currentState().keys.left=1},t.prototype.upOff=function(){g.currentState().keys.up=0},t.prototype.downOff=function(){g.currentState().keys.down=0},t.prototype.rightOff=function(){g.currentState().keys.right=0},t.prototype.leftOff=function(){g.currentState().keys.left=0},t.prototype.keydown=function(t){t.preventDefault();var t=t.keyCode?t.keyCode:t.which,e=g.currentState();(38===t||87===t)&&e.upOn(),(39===t||68===t)&&e.rightOn(),(40===t||83===t)&&e.downOn(),(37===t||65===t)&&e.leftOn()},t.prototype.bindEvents=function(){var t=g.currentState();window.addEventListener("keydown",t.keydown,!1),window.addEventListener("resize",t.resize,!1)},t.prototype.step=function(){this.boardTiles.each("update"),this.boardTiles.each("render"),this.snake.update(),this.snake.render(),this.food.update(),this.food.render(),this.time.update()},t.prototype.exit=function(){window.removeEventListener("keydown",this.keydown,!1),window.removeEventListener("resize",this.resize,!1),this.stageElem.innerHTML="",this.grid.tiles=null,this.time=null},g.addState(new t)}(),g.config={title:"Snakely",debug:"#debug"==window.location.hash?1:0,state:"play"},g.setState(g.config.state),g.time=new g.Time,g.step=function(){requestAnimationFrame(g.step),g.states[g.state].step(),g.time.update()},window.addEventListener("load",g.step,!1);
